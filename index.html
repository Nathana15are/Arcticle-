<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üêµ MonkeyGames - Jungle Royale</title>
<style>
:root{
  --bg:#0a1e0f; --card:#123018; --accent:#8b5cf6; --muted:#c0c0b0; --glass: rgba(255,255,255,0.05);
  font-family: 'Segoe UI', Roboto, sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background: linear-gradient(160deg,#0a1e0f,#123018); color:#e6eef8; overflow:hidden; position:relative; height:100vh;}
.particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;}
.particle{position:absolute; width:10px; height:10px; background:rgba(139,92,246,0.3); border-radius:50%; animation:fall linear infinite;}
@keyframes fall{0%{transform:translateY(-10px) rotate(0deg);}100%{transform:translateY(110vh) rotate(360deg);}}
.app{position:relative; z-index:1; min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:20px; gap:20px;}
.header{width:100%; max-width:1200px; display:flex; justify-content:space-between; align-items:center;}
.logo{font-size:28px;font-weight:bold; color:var(--accent); text-shadow:0 0 15px var(--accent);}
.subtitle{font-size:12px;color:var(--muted);}
.container{display:flex; flex-direction:column; width:100%; max-width:1200px; gap:20px; overflow-y:auto; flex:1;}
.panel{background:var(--card); border-radius:12px; padding:16px; box-shadow: 0 8px 20px rgba(0,0,0,0.7); transition:0.3s; transform:translateY(0);}
.panel:hover{transform:translateY(-4px); box-shadow:0 12px 28px rgba(139,92,246,0.6);}
.grid{display:grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); gap:16px;}
.card{background:var(--glass); padding:12px; border-radius:10px; cursor:pointer; transition:0.3s; display:flex; flex-direction:column; gap:12px; border:1px solid rgba(139,92,246,0.2); opacity:0; transform:translateY(15px); animation:fadeInUp 0.6s ease forwards;}
.card:hover{transform:translateY(-6px) rotateZ(1deg); box-shadow:0 12px 28px rgba(139,92,246,0.8); border:1px solid var(--accent);}
.card h3{font-size:16px;}
.card p{font-size:12px;color:var(--muted);}
.card.flash{animation:flashNeon 0.3s;}
@keyframes flashNeon{0%{box-shadow:0 0 8px #8b5cf6; transform:scale(1.02);}50%{box-shadow:0 0 20px #8b5cf6; transform:scale(1.05);}100%{box-shadow:0 0 8px #8b5cf6; transform:scale(1);}}
.answer-select{margin:8px 0; padding:8px; border-radius:6px; background:rgba(255,255,255,0.1); border:none; color:#fff;}
.answer-btn{margin:8px 0; padding:12px; border-radius:8px; border:none; background:rgba(255,255,255,0.1); color:#fff; cursor:pointer; transition:0.3s; display:block;}
.answer-btn:hover{background:var(--accent); transform:scale(1.05);}
.correct{background:green !important;}
.wrong{background:red !important;}
.btn{padding:8px 12px; border-radius:8px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(139,92,246,0.5); color:inherit; cursor:pointer; transition:0.3s;}
.btn:hover{box-shadow:0 0 12px var(--accent); transform:scale(1.05);}
.footer{text-align:center;color:var(--muted); font-size:12px; display:flex; justify-content:center; align-items:center; gap:10px; flex-direction:column;}
.admin-panel{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:1000; animation:fadeIn 0.3s;}
.admin-content{background:var(--card); padding:20px; border-radius:12px; max-width:500px; width:90%; max-height:90%; overflow:auto; box-shadow:0 0 20px rgba(139,92,246,0.7);}
.admin-content h3{color:var(--accent); text-align:center; text-shadow:0 0 6px var(--accent);}
.close-btn{margin-top:10px;background:var(--accent); color:#fff; cursor:pointer; transition:0.3s;}
.close-btn:hover{box-shadow:0 0 12px var(--accent); transform:scale(1.05);}
#monkeySoundBtn{margin-top:10px; background:#ffeb3b; color:#000; font-weight:bold;}
@keyframes fadeInUp{0%{opacity:0; transform:translateY(20px);}100%{opacity:1; transform:translateY(0);}}
@keyframes fadeIn{from{opacity:0;} to{opacity:1;}}
/* Roue du destin */
#wheelCanvas{background:#123018; border-radius:50%; display:block; margin:20px auto;}
</style>
</head>
<body>
<div class="particles" id="particles"></div>

<div class="app">
  <div class="header">
    <div>
      <div class="logo">üêµ MonkeyGames</div>
      <div class="subtitle">Quiz & Actualit√©s de la Jungle</div>
    </div>
    <button class="btn" id="adminBtn">Admin</button>
  </div>

  <div class="container">
    <div class="panel">
      <h2>üß† Quiz de la Jungle</h2>
      <div class="grid" id="quizList"></div>
    </div>

    <div class="panel">
      <h2>üì∞ Actualit√©s</h2>
      <div class="grid" id="newsList"></div>
    </div>

    <div class="panel">
      <h2>üé° Roue du Destin</h2>
      <canvas id="wheelCanvas" width="400" height="400"></canvas>
      <button class="btn" id="spinBtn">Tourner la roue !</button>
      <p id="wheelResult"></p>
    </div>
  </div>

  <div class="footer">
    ¬© 2025 MonkeyGames
    <button class="btn" id="monkeySoundBtn">üéµ Cri de singe</button>
  </div>
</div>

<div class="admin-panel" id="adminPanel">
  <div class="admin-content">
    <h3>Admin Panel</h3>
    <input type="password" id="adminPass" placeholder="Mot de passe">
    <button class="btn" id="loginBtn">Se connecter</button>
    <div id="adminForms" style="display:none;">
      <h3>Ajouter un Quiz</h3>
      <input id="quizName" placeholder="Nom du quiz">
      <input id="quizQuestion" placeholder="Question">
      <input id="r1" placeholder="R√©ponse 1">
      <input id="r2" placeholder="R√©ponse 2">
      <input id="r3" placeholder="R√©ponse 3">
      <input id="good" placeholder="Bonne r√©ponse">
      <button class="btn" id="saveQuiz">Ajouter Quiz</button>
      <hr>
      <h3>Ajouter Actualit√©</h3>
      <input id="newsTitle" placeholder="Titre">
      <textarea id="newsContent" placeholder="Contenu"></textarea>
      <button class="btn" id="saveNews">Ajouter Actualit√©</button>
    </div>
    <button class="btn close-btn" id="closeAdmin">Fermer</button>
  </div>
</div>

<audio id="clickSound" src="https://assets.codepen.io/605876/click-neon.mp3" preload="auto"></audio>
<audio id="suspenseSound" src="https://assets.codepen.io/605876/suspense-loop.mp3" loop autoplay preload="auto"></audio>
<audio id="monkeySound" src="https://assets.codepen.io/605876/monkey-cry.mp3" preload="auto"></audio>

<script>
const SHEET_URL="https://sheetdb.io/api/v1/b3hru5umxritu";
const ADMIN_PASS="Marius2013.";
const wheelRoles=[
  "ü™∂ Esprit Supr√™me","‚ö° Singe Ancestral","üåï Singe Lunaire",
  "üî• Singe du Chaos","üíé Singe Dor√©","üçÉ Singe Forestier","üåßÔ∏è Singe Pluvieux"
];

// ---------------- PARTICULES ----------------
function createParticles(){
  for(let i=0;i<50;i++){
    const p=document.createElement("div");
    p.className="particle";
    p.style.left=Math.random()*100+"%";
    p.style.animationDuration=(3+Math.random()*5)+"s";
    p.style.width=(5+Math.random()*10)+"px";
    p.style.height=p.style.width;
    document.getElementById("particles").appendChild(p);
  }
}
createParticles();

// ---------------- LOAD DATA ----------------
async function loadData(){
  try{
    const res=await fetch(SHEET_URL);
    const data=await res.json();
    const quizList=document.getElementById("quizList");
    const newsList=document.getElementById("newsList");
    quizList.innerHTML=""; newsList.innerHTML="";
    data.forEach((row,i)=>{
      if(row.type==="quiz"){
        const card=document.createElement("div");
        card.className="card";
        card.style.animationDelay=`${i*0.1}s`;
        card.innerHTML=`<h3>${row.nom||"Sans Nom"}</h3><p>${row.question||"Pas de question"}</p>
          <button class="btn adminQuizBtn">‚öôÔ∏è Admin</button>`;
        quizList.appendChild(card);
        card.querySelector(".adminQuizBtn").onclick=(e)=>{
          e.stopPropagation();
          adminAction(row);
        }
        card.onclick=()=>showQuiz(card,row);
      } else if(row.type==="news"){
        const card=document.createElement("div");
        card.className="card";
        card.style.animationDelay=`${i*0.1}s`;
        card.innerHTML=`<h3>${row.titre||"Sans titre"}</h3><p>${row.contenu||"Pas de contenu"}</p>
          <button class="btn adminQuizBtn">‚öôÔ∏è Admin</button>`;
        newsList.appendChild(card);
        card.querySelector(".adminQuizBtn").onclick=(e)=>{
          e.stopPropagation();
          adminAction(row);
        }
      }
    });
  } catch(e){alert("Erreur lecture SheetDB : "+e);}
}

// ---------------- QUIZ ----------------
function showQuiz(card,row){
  document.getElementById("clickSound").play();
  card.classList.add("flash");
  setTimeout(()=>card.classList.remove("flash"),300);
  if(card.querySelector(".answers")) return;

  const answersContainer = document.createElement("div");
  answersContainer.className = "answers";

  const select = document.createElement("select");
  select.className = "answer-select";

  ["r1","r2","r3"].forEach((r,i)=>{
    if(row[r]){
      const option = document.createElement("option");
      option.value = row[r];
      option.textContent = `${i+1}. ${row[r]}`;
      select.appendChild(option);
    }
  });

  const checkBtn = document.createElement("button");
  checkBtn.textContent = "‚úÖ Valider";
  checkBtn.className = "btn";
  checkBtn.onclick = () => {
    const val = select.value;
    if(val === row.bonne){
      alert("üéâ Bonne r√©ponse !");
    } else {
      alert(`‚ùå Mauvaise r√©ponse ! La bonne r√©ponse √©tait : ${row.bonne}`);
    }
  }

  answersContainer.appendChild(select);
  answersContainer.appendChild(checkBtn);
  card.appendChild(answersContainer);
}

// ---------------- ADMIN ----------------
function adminAction(row){
  const pass=prompt("Mot de passe admin requis :");
  if(pass!==ADMIN_PASS)return alert("Mot de passe incorrect !");
  const action=confirm("OK = Modifier, Annuler = Supprimer ?");
  if(action){
    const newValue=prompt("√âdite ton contenu :", row.question||row.contenu);
    if(newValue){
      let updated=row;
      if(row.type==="quiz") updated.question=newValue;
      else updated.contenu=newValue;
      fetch(`${SHEET_URL}/id/${row.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(updated)}).then(()=>loadData());
    }
  }else{
    if(confirm("Supprimer d√©finitivement ?")){
      fetch(`${SHEET_URL}/id/${row.id}`,{method:"DELETE"}).then(()=>loadData());
    }
  }
}

document.getElementById("adminBtn").onclick=()=>document.getElementById("adminPanel").style.display="flex";
document.getElementById("closeAdmin").onclick=()=>document.getElementById("adminPanel").style.display="none";
document.getElementById("loginBtn").onclick=()=>{
  const val=document.getElementById("adminPass").value;
  if(val===ADMIN_PASS) document.getElementById("adminForms").style.display="block";
  else alert("Mot de passe incorrect üü•");
};
document.getElementById("saveQuiz").onclick=()=>{
  const data={type:"quiz",nom:document.getElementById("quizName").value,question:document.getElementById("quizQuestion").value,r1:document.getElementById("r1").value,r2:document.getElementById("r2").value,r3:document.getElementById("r3").value,bonne:document.getElementById("good").value};
  fetch(SHEET_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(()=>{alert("Quiz ajout√© ‚úÖ");loadData();});
};
document.getElementById("saveNews").onclick=()=>{
  const data={type:"news",titre:document.getElementById("newsTitle").value,contenu:document.getElementById("newsContent").value};
  fetch(SHEET_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then(()=>{alert("Actualit√© ajout√©e ‚úÖ");loadData();});
};
document.getElementById("monkeySoundBtn").onclick=()=>{
  const sound=document.getElementById("monkeySound");
  sound.currentTime=0;
  sound.play();
};

// ---------------- WHEEL ----------------
const wheelCanvas=document.getElementById("wheelCanvas");
const ctx=wheelCanvas.getContext("2d");
const wheelRadius=200;
let spinning=false;
let lastSpin=localStorage.getItem("lastSpin")||0;

function drawWheel(){
  const angleStep=(2*Math.PI)/wheelRoles.length;
  for(let i=0;i<wheelRoles.length;i++){
    const start=i*angleStep;
    const end=start+angleStep;
    ctx.beginPath();
    ctx.moveTo(wheelRadius,wheelRadius);
    ctx.arc(wheelRadius,wheelRadius,wheelRadius,start,end);
    ctx.fillStyle=i%2===0?"#8b5cf6":"#ffb347";
    ctx.fill();
    ctx.save();
    ctx.translate(wheelRadius,wheelRadius);
    ctx.rotate(start+angleStep/2);
    ctx.fillStyle="#000";
    ctx.font="16px Arial";
    ctx.textAlign="right";
    ctx.fillText(wheelRoles[i],wheelRadius-10,0);
    ctx.restore();
  }
}
drawWheel();

document.getElementById("spinBtn").onclick=()=>{
  const now=Date.now();
  if(now-lastSpin<24*60*60*1000){alert("‚è≥ Tu ne peux tourner la roue qu'une fois par jour !"); return;}
  lastSpin=now;
  localStorage.setItem("lastSpin",lastSpin);
  spinning=true;
  let spinDeg=0;
  const spinInterval=setInterval(()=>{
    spinDeg+=10+Math.random()*20;
    ctx.clearRect(0,0,wheelCanvas.width,wheelCanvas.height);
    ctx.save();
    ctx.translate(wheelRadius,wheelRadius);
    ctx.rotate(spinDeg*Math.PI/180);
    ctx.translate(-wheelRadius,-wheelRadius);
    drawWheel();
    ctx.restore();
    if(spinDeg>=3600){ // arr√™te apr√®s ~10 tours
      clearInterval(spinInterval);
      spinning=false;
      const finalAngle=(spinDeg%360);
      const idx=Math.floor((360-finalAngle)/(360/wheelRoles.length))%wheelRoles.length;
      const role=wheelRoles
