<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Id√©es coll√®ge Broceliande</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
body{background:linear-gradient(135deg,#74ebd5,#ACB6E5);color:#222;padding:10px;}
.form-box{background:white;padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
textarea{width:100%;height:80px;padding:8px;border-radius:5px;border:1px solid #ccc;resize:none;}
.counter{text-align:right;font-size:12px;margin-top:3px;}
.tags{display:flex;flex-wrap:wrap;margin:8px 0;}
.tags span{margin:2px 4px;padding:5px 8px;background:#eee;border-radius:5px;font-size:12px;cursor:pointer;}
button{width:100%;padding:10px;margin:4px 0;border:none;border-radius:6px;cursor:pointer;}
.btn-primary{background:#4e54c8;color:white;}
.btn-reset{background:#ccc;color:black;}
.btn-micro{background:#ff9f43;color:white;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px;}
th,td{border:1px solid #ddd;padding:5px;text-align:center;}
th{background:#4e54c8;color:white;}
@media(max-width:600px){textarea{height:60px;} button{font-size:14px;} .tags span{font-size:11px;padding:4px 6px;}}
</style>
</head>
<body>

<div class="form-box">
<h2>üí° Vos id√©es pour am√©liorer le coll√®ge</h2>
<textarea id="idea" placeholder="√âcris ton id√©e ici..."></textarea>
<div class="counter" id="counter">0 / 200</div>
<div class="tags">
<span>#Cantine</span><span>#Sport</span><span>#Cours</span><span>#CDI</span>
<span>#Musique</span><span>#Lecture</span><span>#Am√©nagement</span><span>#Club</span>
<span>#Sortie</span><span>#√âco</span><span>#Technologie</span><span>#Arts</span>
<span>#Jardin</span><span>#√âv√©nement</span><span>#Bien-√™tre</span>
</div>
<input type="text" id="name" placeholder="Pr√©nom (facultatif)"><br>
<label><input type="checkbox" id="anonymous"> Envoyer anonymement</label>
<button class="btn-primary" id="send-btn">Envoyer</button>
<button class="btn-reset" id="reset-btn">R√©initialiser</button>
<div id="confirmation" style="display:none;margin-top:8px;padding:8px;background:#d4edda;color:#155724;border-radius:5px;">‚úÖ Envoy√© !</div>
</div>

<div class="form-box"><h3>‚úÖ Id√©es accept√©es</h3><table id="table-accepted"><tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr></table></div>
<div class="form-box"><h3>‚ùå Id√©es refus√©es</h3><table id="table-refused"><tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr></table></div>

<div class="form-box">
<h3>‚öôÔ∏è Admin</h3>
<input type="password" id="admin-pass" placeholder="Mot de passe">
<button id="admin-login-btn" class="btn-primary">Se connecter</button>
<div id="admin-panel" style="display:none">
<table id="table-admin"><tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th><th>Statut</th><th>Actions</th></tr></table>
</div>
</div>

<script>
const SHEETDB="https://sheetdb.io/api/v1/vu7li5z94eqkt";
const textarea=document.getElementById("idea");
textarea.addEventListener("input",()=>document.getElementById("counter").innerText=textarea.value.length+" / 200");

document.getElementById("reset-btn").addEventListener("click",()=>{textarea.value="";document.getElementById("counter").innerText="0 / 200";document.getElementById("name").value="";document.getElementById("anonymous").checked=false;});
document.getElementById("send-btn").addEventListener("click",submitIdea);

async function submitIdea(){
  const text=textarea.value.trim();
  if(!text){alert("√âcris une id√©e");return;}
  const prenom=document.getElementById("anonymous").checked?"Anonyme":document.getElementById("name").value||"";
  await fetch(SHEETDB,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{idee:text,prenom:prenom,statut:"En attente"}})});
  textarea.value="";document.getElementById("counter").innerText="0 / 200";document.getElementById("name").value="";document.getElementById("anonymous").checked=false;
  document.getElementById("confirmation").style.display="block";
  setTimeout(()=>{document.getElementById("confirmation").style.display="none";},1500);
  loadTables();
}

document.getElementById("admin-login-btn").addEventListener("click",()=>{
  const pass=document.getElementById("admin-pass").value;
  if(pass==="Marius2013"){document.getElementById("admin-panel").style.display="block";loadTables();}
  else{alert("Mot de passe incorrect");}
});

async function loadTables(){
  const data=await fetch(SHEETDB).then(r=>r.json());
  const tAcc=document.getElementById("table-accepted");
  const tRef=document.getElementById("table-refused");
  const tAdmin=document.getElementById("table-admin");
  tAcc.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr>";
  tRef.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr>";
  tAdmin.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th><th>Statut</th><th>Actions</th></tr>";

  data.forEach(item=>{
    if(item.statut==="Accept√©e"){const r=document.createElement("tr");r.innerHTML=`<td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td>`;tAcc.appendChild(r);}
    else if(item.statut==="Refus√©e"){const r=document.createElement("tr");r.innerHTML=`<td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td>`;tRef.appendChild(r);}

    const rAdmin=document.createElement("tr");
    rAdmin.innerHTML=`<td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td><td>${item.statut}</td>`;
    const td=document.createElement("td");

    if(item.statut==="En attente"){
      const bAcc=document.createElement("button"); bAcc.textContent="‚úÖ Accepter"; bAcc.className="btn-primary"; bAcc.onclick=()=>changeStatus(item.id,"Accept√©e");
      const bRef=document.createElement("button"); bRef.textContent="‚ùå Refuser"; bRef.className="btn-reset"; bRef.onclick=()=>changeStatus(item.id,"Refus√©e");
      td.appendChild(bAcc); td.appendChild(bRef);
    }

    const bDel=document.createElement("button"); bDel.textContent="üóëÔ∏è Supprimer"; bDel.className="btn-micro"; bDel.onclick=()=>deleteIdea(item.id);
    td.appendChild(bDel); rAdmin.appendChild(td); tAdmin.appendChild(rAdmin);
  });
}

async function changeStatus(id,status){await fetch(`${SHEETDB}/id/${id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{statut:status}})}); loadTables();}
async function deleteIdea(id){if(confirm("Supprimer cette id√©e ?")){await fetch(`${SHEETDB}/id/${id}`,{method:"DELETE"}); loadTables();}}
loadTables();
</script>
</body>
</html>
