<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mes Remarques</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f5f6fa; margin:0; padding:10px; }
.container { max-width:600px; margin:20px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
h2 { text-align:center; margin-bottom:20px; color:#2f3640; font-size:1.5em; }
input, select, button, textarea { width:100%; padding:14px; margin:8px 0; border-radius:8px; border:1px solid #dcdde1; box-sizing:border-box; font-size:1em; }
button { background:#4cd137; color:white; border:none; cursor:pointer; font-weight:bold; transition:0.3s; }
button:hover { background:#44bd32; }
.remarque { padding:12px; margin-bottom:12px; background:#f1f2f6; border-radius:8px; word-break:break-word; }
.validé { background-color:#dff9fb; border-left:4px solid #00cec9; }
#loginContainer button { width:48%; margin-right:2%; padding:14px; }
#loginContainer button:last-child { margin-right:0; }
textarea { resize:none; height:80px; }
@media(max-width:640px){
    .container{ margin:10px; padding:15px; }
    h2{ font-size:1.3em; }
    input, select, button, textarea{ font-size:1em; padding:12px; }
}
</style>
</head>
<body>

<div class="container" id="loginContainer">
    <h2>Connexion</h2>
    <button type="button" id="btnAdmin">Admin</button>
    <button type="button" id="btnUser">Utilisateur</button>
</div>

<div class="container" id="formLogin" style="display:none;">
    <h2 id="loginTitle"></h2>
    <input type="password" id="password" placeholder="Mot de passe">
    <button type="button" id="btnConnexion">Se connecter</button>
</div>

<div class="container" id="appContainer" style="display:none;">
    <h2>Remarques</h2>
    <div id="adminSection" style="display:none;">
        <select id="userSelect">
            <option value="">Choisir un utilisateur</option>
        </select>
        <textarea id="texteRemarque" placeholder="Écris la remarque ici"></textarea>
        <button type="button" id="btnAjouter">Ajouter Remarque</button>
    </div>
    <div id="remarquesList"></div>
    <button type="button" style="background:#e84118;" id="btnDeconnexion">Se Déconnecter</button>
</div>

<script>
// Utilisateurs et mots de passe
const utilisateurs = [
    {Nom:"Hamza", MotDePasse:"Hamza1"},
    {Nom:"Maya", MotDePasse:"Maya2"},
    {Nom:"Noah", MotDePasse:"Noah3"},
    {Nom:"Swan", MotDePasse:"Swan4"},
    {Nom:"Matheo", MotDePasse:"Matheo5"}
];

const adminMdp = "Marius2013.";
const sheetURL = "https://sheetdb.io/api/v1/jiqnkf4kvninf";

let userType = null;
let currentUser = null;

// Sélecteurs
const loginContainer = document.getElementById("loginContainer");
const formLogin = document.getElementById("formLogin");
const appContainer = document.getElementById("appContainer");
const loginTitle = document.getElementById("loginTitle");
const passwordInput = document.getElementById("password");
const remarquesList = document.getElementById("remarquesList");

// Choix connexion
document.getElementById("btnAdmin").addEventListener("click", () => {
    userType = "admin";
    loginContainer.style.display="none";
    formLogin.style.display="block";
    loginTitle.innerText = "Connexion Admin";
});
document.getElementById("btnUser").addEventListener("click", () => {
    userType = "user";
    loginContainer.style.display="none";
    formLogin.style.display="block";
    loginTitle.innerText = "Connexion Utilisateur";
});

// Connexion
document.getElementById("btnConnexion").addEventListener("click", async () => {
    const mdp = passwordInput.value.trim();
    if(userType==="admin" && mdp===adminMdp){
        currentUser="Admin";
        formLogin.style.display="none";
        appContainer.style.display="block";
        document.getElementById("adminSection").style.display="block";
        remplirListeUtilisateurs();
        chargerRemarques();
    } else if(userType==="user"){
        const user = utilisateurs.find(u => u.MotDePasse===mdp);
        if(user){
            currentUser=user.Nom;
            formLogin.style.display="none";
            appContainer.style.display="block";
            document.getElementById("adminSection").style.display="none";
            chargerRemarques();
        } else {
            alert("Mot de passe incorrect !");
        }
    } else {
        alert("Mot de passe incorrect !");
    }
});

// Remplir liste utilisateurs pour admin
function remplirListeUtilisateurs(){
    const select = document.getElementById("userSelect");
    select.innerHTML = '<option value="">Choisir un utilisateur</option>';
    utilisateurs.forEach(u=>{
        const option = document.createElement("option");
        option.value = u.Nom;
        option.textContent = u.Nom;
        select.appendChild(option);
    });
}

// Ajouter remarque
document.getElementById("btnAjouter").addEventListener("click", async () => {
    const userSelect = document.getElementById("userSelect").value;
    const texte = document.getElementById("texteRemarque").value.trim();
    if(!userSelect || !texte){
        alert("Choisis un utilisateur et écris une remarque");
        return;
    }
    await fetch(sheetURL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({User:userSelect, Texte:texte})
    });
    document.getElementById("texteRemarque").value="";
    chargerRemarques();
});

// Charger remarques
async function chargerRemarques(){
    remarquesList.innerHTML="Chargement...";
    const res = await fetch(sheetURL);
    const data = await res.json();
    remarquesList.innerHTML="";
    data.forEach(item=>{
        if(currentUser==="Admin" || item.User===currentUser){
            const div=document.createElement("div");
            div.className="remarque";
            div.innerHTML=`<strong>${item.User}</strong>: ${item.Texte}`;
            remarquesList.appendChild(div);
        }
    });
}

// Déconnexion
document.getElementById("btnDeconnexion").addEventListener("click", () => {
    currentUser=null;
    userType=null;
    appContainer.style.display="none";
    formLogin.style.display="none";
    loginContainer.style.display="block";
    passwordInput.value="";
    remarquesList.innerHTML="";
});
</script>

</body>
</html>
