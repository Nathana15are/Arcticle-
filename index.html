<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Id√©es pour am√©liorer le coll√®ge</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Nunito',sans-serif;}
body{background:linear-gradient(135deg,#74ebd5,#ACB6E5);color:#222;display:block;padding:15px;}
header{background:#4e54c8;color:white;padding:20px;text-align:center;border-radius:8px;margin-bottom:20px;}
.form-box{background:white;padding:15px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.2);margin-bottom:20px;width:100%;}
textarea{width:100%;height:100px;padding:10px;border:1px solid #ccc;border-radius:6px;resize:none;}
.counter{text-align:right;font-size:12px;margin-top:4px;}
.tags{margin:10px 0;display:flex;flex-wrap:wrap;}
.tags span{display:inline-block;background:#e1e1e1;padding:6px 10px;margin:4px;border-radius:6px;cursor:pointer;font-size:12px;}
button{margin:5px 0;padding:12px;border:none;border-radius:6px;cursor:pointer;transition:0.3s;width:100%;font-size:16px;}
button:hover{transform:scale(1.03);}
.btn-primary{background:#4e54c8;color:white;}
.btn-reset{background:#ccc;color:#000;}
.btn-micro{background:#ff9f43;color:white;}
.table-admin{width:100%;border-collapse:collapse;margin-top:15px;font-size:14px;}
.table-admin th,.table-admin td{border:1px solid #ddd;padding:6px;text-align:center;}
.table-admin th{background:#4e54c8;color:white;font-size:14px;}
.status-accepted{background:#c3f0c3;}
.status-refused{background:#f0c3c3;}
.toggle-dark{position:fixed;top:10px;right:10px;cursor:pointer;background:#222;color:white;padding:6px 10px;border-radius:6px;font-size:14px;}
body.dark{background:#222;color:#eee;}
body.dark .form-box{background:#333;color:#eee;}
body.dark textarea{background:#555;color:white;}
@media(max-width:600px){textarea{height:80px;} .tags span{font-size:11px;padding:5px 8px;} button{font-size:14px;}}
</style>
</head>
<body>
<button class="toggle-dark" onclick="document.body.classList.toggle('dark')">üåô Mode sombre</button>

<div id="accueil" class="form-box">
<header><h1>üí° Vos id√©es pour am√©liorer le coll√®ge</h1></header>
<textarea id="idea" placeholder="√âcris ton id√©e ici..."></textarea>
<div class="counter" id="counter">0 / 200</div>
<div class="tags">
<span>#Cantine</span><span>#Sport</span><span>#Cours</span><span>#CDI</span>
<span>#Musique</span><span>#Lecture</span><span>#Am√©nagement</span><span>#Club</span>
<span>#Sortie</span><span>#√âco</span><span>#Technologie</span><span>#Arts</span>
<span>#Jardin</span><span>#√âv√©nement</span><span>#Bien-√™tre</span>
</div>
<input type="text" id="name" placeholder="Ton pr√©nom (facultatif)"><br>
<label><input type="checkbox" id="anonymous"> Envoyer anonymement</label><br>
<button class="btn-primary" id="send-btn">Envoyer</button>
<button class="btn-reset" id="reset-btn">R√©initialiser</button>
<button class="btn-micro" id="dictate-btn">üé§ Dicter</button>
<div class="confirmation" id="confirmation" style="display:none;margin-top:10px;background:#d4edda;color:#155724;padding:10px;border-radius:6px;">‚úÖ Ton id√©e a bien √©t√© envoy√©e !</div>
</div>

<div id="accepted" class="form-box"><h2>‚úÖ Id√©es accept√©es</h2>
<table class="table-admin" id="table-accepted"><tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr></table>
</div>

<div id="refused" class="form-box"><h2>‚ùå Id√©es refus√©es</h2>
<table class="table-admin" id="table-refused"><tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr></table>
</div>

<div id="admin" class="form-box">
<h2>‚öôÔ∏è Admin (prot√©g√©)</h2>
<input type="password" id="admin-pass" placeholder="Mot de passe">
<button id="admin-login-btn">Se connecter</button>
<div id="admin-panel" style="display:none">
<table class="table-admin" id="table-admin">
<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th><th>Statut</th><th>Actions</th></tr>
</table>
</div>
</div>

<script>
const SHEETDB_URL="https://sheetdb.io/api/v1/vu7li5z94eqkt";
const placeholders=["Installer plus de bancs dans la cour""Cr√©er un club de musique","Organiser une journ√©e sans cartable","Mettre des distributeurs de fruits"];
let index=0;
setInterval(()=>{document.getElementById("idea").placeholder=placeholders[index];index=(index+1)%placeholders.length;},4000);

const textarea=document.getElementById("idea");
textarea.addEventListener("input",()=>{document.getElementById("counter").innerText=textarea.value.length+" / 200";});

document.getElementById("reset-btn").addEventListener("click",()=>{textarea.value="";document.getElementById("counter").innerText="0 / 200";document.getElementById("name").value="";document.getElementById("anonymous").checked=false;});

document.getElementById("dictate-btn").addEventListener("click",()=>{
  if('webkitSpeechRecognition' in window){
    const recognition=new webkitSpeechRecognition();
    recognition.lang="fr-FR";
    recognition.onresult=function(event){textarea.value=event.results[0][0].transcript;document.getElementById("counter").innerText=textarea.value.length+" / 200";};
    recognition.start();
  }else{alert("Reconnaissance vocale non support√©e.");}
});

document.querySelectorAll(".tags span").forEach(tag=>{tag.addEventListener("click",()=>{textarea.value+=" "+tag.innerText;document.getElementById("counter").innerText=textarea.value.length+" / 200";});});

document.getElementById("send-btn").addEventListener("click",submitIdea);

function submitIdea(){
  const ideaVal=textarea.value.trim();
  if(!ideaVal){alert("Merci d'√©crire une id√©e"); return;}
  const prenom=document.getElementById("anonymous").checked?"Anonyme":document.getElementById("name").value||"";
  const data={data:{idee:ideaVal,prenom:prenom,statut:"En attente"}};
  fetch(SHEETDB_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)})
  .then(()=>{textarea.value="";document.getElementById("counter").innerText="0 / 200";document.getElementById("name").value="";document.getElementById("anonymous").checked=false;showConfirmation();loadTables();})
  .catch(err=>{alert("Erreur lors de l'envoi"); console.error(err);});
}

function showConfirmation(){const c=document.getElementById("confirmation");c.style.display="block";setTimeout(()=>{c.style.display="none";},2000);}

document.getElementById("admin-login-btn").addEventListener("click",()=>{
  const pass=document.getElementById("admin-pass").value;
  if(pass==="Marius2013"){document.getElementById("admin-panel").style.display="block";loadTables();}else{alert("Mot de passe incorrect");}
});

async function loadTables(){
  const data=await fetch(SHEETDB_URL).then(r=>r.json());
  const acceptedTable=document.getElementById("table-accepted");
  acceptedTable.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr>";
  const refusedTable=document.getElementById("table-refused");
  refusedTable.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr>";
  const adminTable=document.getElementById("table-admin");
  adminTable.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th><th>Statut</th><th>Actions</th></tr>";

  data.forEach(item=>{
    // Accept√©es / Refus√©es
    const trAcc=document.createElement("tr");
    const trRef=document.createElement("tr");
    if(item.statut==="Accept√©e"){trAcc.innerHTML=`<td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td>`;acceptedTable.appendChild(trAcc);}
    else if(item.statut==="Refus√©e"){trRef.innerHTML=`<td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td>`;refusedTable.appendChild(trRef);}

    // Admin
    const trAdmin=document.createElement("tr");
    trAdmin.innerHTML=`<td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td><td>${item.statut}</td>`;
    const tdActions=document.createElement("td");

    if(item.statut==="En attente"){
      const btnAcc=document.createElement("button");
      btnAcc.textContent="‚úÖ Accepter";
      btnAcc.className="btn-primary";
      btnAcc.addEventListener("click",()=>changeStatus(item.id,"Accept√©e"));

      const btnRef=document.createElement("button");
      btnRef.textContent="‚ùå Refuser";
      btnRef.className="btn-reset";
      btnRef.addEventListener("click",()=>changeStatus(item.id,"Refus√©e"));

      tdActions.appendChild(btnAcc);
      tdActions.appendChild(btnRef);
    }

    const btnDel=document.createElement("button");
    btnDel.textContent="üóëÔ∏è Supprimer";
    btnDel.className="btn-micro";
    btnDel.addEventListener("click",()=>deleteIdea(item.id));

    tdActions.appendChild(btnDel);
    trAdmin.appendChild(tdActions);
    adminTable.appendChild(trAdmin);
  });
}

async function changeStatus(id,status){
  await fetch(`${SHEETDB_URL}/id/${id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{statut:status}})});
  loadTables();
}

async function deleteIdea(id){
  if(confirm("Supprimer cette id√©e ?")){await fetch(`${SHEETDB_URL}/id/${id}`,{method:"DELETE"}); loadTables();}
}

// Chargement initial
loadTables();
</script>
</body>
</html>
