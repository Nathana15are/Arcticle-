<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Id√©es pour am√©liorer le coll√®ge</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Nunito',sans-serif;}
html,body{height:100%;overflow:hidden;}
body{background:linear-gradient(135deg,#74ebd5,#ACB6E5);color:#222;display:flex;}
nav{width:220px;background:#2a2f4f;color:white;height:100vh;position:fixed;left:0;top:0;display:flex;flex-direction:column;align-items:center;padding-top:20px;}
nav h2{margin-bottom:20px;}
nav a{text-decoration:none;color:white;padding:12px;display:block;width:100%;text-align:center;border-radius:6px;margin:6px 0;transition:0.3s;}
nav a:hover{background:#50577a;}
.container{margin-left:240px;padding:20px;flex:1;display:flex;flex-direction:column;align-items:center;min-height:100vh;overflow-y:auto;}
header{background:#4e54c8;color:white;padding:20px;text-align:center;border-radius:8px;margin-bottom:20px;animation:bannerChange 10s infinite;}
@keyframes bannerChange{0%{background:#4e54c8;}50%{background:#8f94fb;}100%{background:#4e54c8;}}
.form-box{background:white;padding:20px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.2);max-width:600px;width:100%;margin-bottom:20px;}
textarea{width:100%;height:100px;padding:10px;border:1px solid #ccc;border-radius:6px;resize:none;}
.counter{text-align:right;font-size:12px;margin-top:4px;}
.tags{margin:10px 0;}
.tags span{display:inline-block;background:#e1e1e1;padding:6px 10px;margin:4px;border-radius:6px;cursor:pointer;}
button{margin:8px 4px;padding:10px 15px;border:none;border-radius:6px;cursor:pointer;transition:0.3s;}
button:hover{transform:scale(1.05);}
.btn-primary{background:#4e54c8;color:white;}
.btn-reset{background:#ccc;}
.btn-micro{background:#ff9f43;color:white;}
.progress-container{width:100%;background:#eee;border-radius:6px;margin-top:10px;display:none;}
.progress-bar{width:0%;height:8px;background:#4e54c8;border-radius:6px;}
.confirmation{display:none;margin-top:15px;padding:10px;background:#d4edda;color:#155724;border-radius:6px;}
body.dark{background:#222;color:#eee;}
body.dark nav{background:#111;}
body.dark .form-box{background:#333;color:#eee;}
body.dark textarea{background:#555;color:white;}
.toggle-dark{position:absolute;top:10px;right:10px;cursor:pointer;background:#222;color:white;padding:6px 10px;border-radius:6px;}
.table-admin{width:100%;border-collapse:collapse;margin-top:20px;}
.table-admin th,.table-admin td{border:1px solid #ddd;padding:8px;text-align:center;}
.table-admin th{background:#4e54c8;color:white;}
.status-accepted{background:#c3f0c3;}
.status-refused{background:#f0c3c3;}
</style>
</head>
<body>
<nav>
<h2>üìò Menu</h2>
<a href="#accueil">üè† Accueil</a>
<a href="#accepted">‚úÖ Accept√©es</a>
<a href="#refused">‚ùå Refus√©es</a>
<a href="#admin">‚öôÔ∏è Admin</a>
</nav>

<div class="container">
<!-- Formulaire -->
<div id="accueil" class="form-box">
<header><h1>üí° Vos id√©es pour am√©liorer le coll√®ge</h1></header>
<button class="toggle-dark">üåô Mode sombre</button>
<textarea id="idea" placeholder="√âcris ton id√©e ici..."></textarea>
<div class="counter" id="counter">0 / 200</div>
<div class="tags">
<span>#Cantine</span><span>#Sport</span><span>#Cours</span><span>#CDI</span>
<span>#Musique</span><span>#Lecture</span><span>#Am√©nagement</span><span>#Club</span>
<span>#Sortie</span><span>#√âco</span><span>#Technologie</span><span>#Arts</span>
<span>#Jardin</span><span>#√âv√©nement</span><span>#Bien-√™tre</span>
</div>
<input type="text" id="name" placeholder="Ton pr√©nom (facultatif)"><br>
<label><input type="checkbox" id="anonymous"> Envoyer anonymement</label><br>
<button class="btn-primary" onclick="submitIdea()">Envoyer</button>
<button class="btn-reset" onclick="resetForm()">R√©initialiser</button>
<button class="btn-micro" onclick="startDictation()">üé§ Dicter</button>
<div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
<div class="confirmation" id="confirmation">‚úÖ Ton id√©e a bien √©t√© envoy√©e !</div>
</div>

<!-- Accept√©es -->
<div id="accepted" class="form-box"><h2>‚úÖ Id√©es accept√©es</h2>
<table class="table-admin" id="table-accepted"><tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr></table>
</div>

<!-- Refus√©es -->
<div id="refused" class="form-box"><h2>‚ùå Id√©es refus√©es</h2>
<table class="table-admin" id="table-refused"><tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr></table>
</div>

<!-- Admin -->
<div id="admin" class="form-box">
<h2>‚öôÔ∏è Admin (prot√©g√©)</h2>
<input type="password" id="admin-pass" placeholder="Mot de passe"><button onclick="checkAdminPass()">Se connecter</button>
<div id="admin-panel" style="display:none">
<table class="table-admin" id="table-admin">
<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th><th>Statut</th><th>Actions</th></tr>
</table>
</div>
</div>
</div>

<script>
const SHEETDB_URL="https://sheetdb.io/api/v1/vu7li5z94eqkt";
const placeholders=["Installer plus de bancs dans la cour","Mettre du WiFi dans le CDI","Cr√©er un club de musique","Organiser une journ√©e sans cartable","Mettre des distributeurs de fruits"];
let index=0;
setInterval(()=>{document.getElementById("idea").placeholder=placeholders[index];index=(index+1)%placeholders.length;},4000);

const textarea=document.getElementById("idea");
textarea.addEventListener("input",()=>{document.getElementById("counter").innerText=textarea.value.length+" / 200";});
function resetForm(){textarea.value="";document.getElementById("counter").innerText="0 / 200";document.getElementById("name").value="";document.getElementById("anonymous").checked=false;}
document.querySelector(".toggle-dark").onclick=()=>{document.body.classList.toggle("dark");}
document.querySelectorAll(".tags span").forEach(tag=>{tag.addEventListener("click",()=>{textarea.value+=" "+tag.innerText;document.getElementById("counter").innerText=textarea.value.length+" / 200";});});

function startDictation(){if('webkitSpeechRecognition' in window){const recognition=new webkitSpeechRecognition();recognition.lang="fr-FR";recognition.onresult=function(event){textarea.value=event.results[0][0].transcript;document.getElementById("counter").innerText=textarea.value.length+" / 200";};recognition.start();}else{alert("Reconnaissance vocale non support√©e.");}}

function submitIdea(){
  const ideaVal=textarea.value.trim();
  if(!ideaVal){alert("Merci d'√©crire une id√©e"); return;}
  const prenom=document.getElementById("anonymous").checked?"Anonyme":document.getElementById("name").value||"";
  const data={data:{idee:ideaVal,prenom:prenom,statut:"En attente"}};
  const bar=document.getElementById("progress-bar"); const container=document.querySelector(".progress-container"); const confirmation=document.getElementById("confirmation");
  container.style.display="block"; let progress=0;
  let loading=setInterval(()=>{progress+=20;bar.style.width=progress+"%";if(progress>=100){clearInterval(loading);bar.style.width="0%";container.style.display="none";confirmation.style.display="block";setTimeout(()=>{confirmation.style.display="none";},2000);}},200);
  fetch(SHEETDB_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)})
  .then(()=>{resetForm();loadTables();}).catch(err=>{alert("Erreur lors de l'envoi"); console.error(err);});
}

// Admin
function checkAdminPass(){const pass=document.getElementById("admin-pass").value;if(pass==="Marius2013"){document.getElementById("admin-panel").style.display="block";loadTables();}else{alert("Mot de passe incorrect");}}

function loadTables(){
  fetch(SHEETDB_URL).then(res=>res.json()).then(data=>{
    // Tables
    const acceptedTable=document.getElementById("table-accepted"); acceptedTable.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr>";
    const refusedTable=document.getElementById("table-refused"); refusedTable.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th></tr>";
    const adminTable=document.getElementById("table-admin"); adminTable.innerHTML="<tr><th>ID</th><th>Id√©e</th><th>Pr√©nom</th><th>Statut</th><th>Actions</th></tr>";
    data.forEach(item=>{
      const row=`<tr><td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td></tr>`;
      if(item.statut==="Accept√©e"){acceptedTable.innerHTML+=row;}
      else if(item.statut==="Refus√©e"){refusedTable.innerHTML+=row;}
      // Admin
      let actions="";
      if(item.statut==="En attente"){
        actions=`<button onclick="changeStatus(${item.id},'Accept√©e')">‚úÖ</button><button onclick="changeStatus(${item.id},'Refus√©e')">‚ùå</button>`;
      }
      actions+=` <button onclick="deleteIdea(${item.id})">üóëÔ∏è</button>`;
      adminTable.innerHTML+=`<tr><td>${item.id}</td><td>${item.idee}</td><td>${item.prenom}</td><td>${item.statut}</td><td>${actions}</td></tr>`;
    });
  });
}

function changeStatus(id,status){
  fetch(`${SHEETDB_URL}/id/${id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{statut:status}})})
  .then(()=>loadTables());
}

function deleteIdea(id){
  if(confirm("Supprimer cette id√©e ?")){fetch(`${SHEETDB_URL}/id/${id}`,{method:"DELETE"}).then(()=>loadTables());}
}

// Auto load tables every 5 sec
setInterval(()=>{loadTables();},5000);

</script>
</body>
</html>
