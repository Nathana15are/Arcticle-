<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monkey Games üêµ</title>
<link rel="icon" href="data:,">
<style>
:root{
  --bg:#0a1e0f;
  --card:#123018;
  --accent:#f8d000;
  --muted:#c0c0b0;
  --danger:#ef4444;
  --success:#16a34a;
  --glass: rgba(255,255,255,0.05);
  font-family: 'Segoe UI', Roboto, sans-serif;
  color-scheme: dark;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background: linear-gradient(160deg,#0a1e0f,#123018); color:#e6eef8;}
.app{min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:20px; gap:20px;}
.header{width:100%; max-width:1200px; display:flex; justify-content:space-between; align-items:center;}
.logo{font-size:24px;font-weight:bold; color:var(--accent);}
.subtitle{font-size:12px;color:var(--muted);}
.container{display:flex; flex-direction:column; width:100%; max-width:1200px; gap:20px;}
.panel{background:var(--card); border-radius:12px; padding:16px; box-shadow: 0 6px 18px rgba(0,0,0,0.5);}
.grid{display:grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); gap:16px;}
.card{background:var(--glass); padding:12px; border-radius:10px; cursor:pointer; transition:.2s; display:flex; flex-direction:column; gap:6px;}
.card:hover{transform:translateY(-4px); box-shadow:0 12px 28px rgba(0,0,0,0.5);}
.card h3{font-size:16px;}
.card p{font-size:12px;color:var(--muted);}
.btn{padding:8px 12px; border-radius:8px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); color:inherit; cursor:pointer;}
.btn.small{font-size:12px;padding:6px 10px;}
.board{display:grid; gap:6px; margin-top:12px;}
.cell{width:48px;height:48px;background:rgba(255,255,255,0.03); border-radius:6px; display:flex; align-items:center; justify-content:center; cursor:pointer;}
.piece{width:36px;height:36px;border-radius:50%;box-shadow: inset 0 -4px 6px rgba(0,0,0,0.4);}
input,textarea{width:100%;margin:6px 0;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:inherit;}
@media(max-width:900px){.board{grid-template-columns: repeat(7,1fr);}}
.footer{text-align:center;color:var(--muted); font-size:12px;}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div><span class="logo">Monkey Games üêµ</span><div class="subtitle">Th√®me Jungle ‚Ä¢ SheetDB</div></div>
    <div style="display:flex;gap:10px;align-items:center;">
      <button id="adminBtn" class="btn small">Admin</button>
    </div>
  </div>

  <div class="container">
    <div class="panel">
      <h2>Jeux & Quiz</h2>
      <div class="grid" id="gamesGrid"></div>
    </div>

    <div class="panel">
      <h2>Actualit√©s üì∞</h2>
      <div id="newsGrid" class="grid"></div>
    </div>

    <div id="gameArea" class="panel"></div>
  </div>

  <div class="footer">¬© 2025 Monkey Games ‚Äî Th√®me Singe üçå</div>
</div>

<template id="cardTemplate">
  <div class="card">
    <h3></h3>
    <p></p>
  </div>
</template>

<script>
// ======================
// CONFIG SHEETDB
// ======================
const SHEETDB_URL = "https://sheetdb.io/api/v1/TON_ID_ICI"; // Remplace par ton vrai lien
const ADMIN_PWD = "Marius2013.";

let DATA = { games: [], quizzes: [], news: [] };

// ======================
// UTILITIES
// ======================
async function fetchSheetDB(){
  try{
    const res = await fetch(SHEETDB_URL);
    const json = await res.json();
    DATA.games = json.filter(x=>x.type==='game');
    DATA.quizzes = json.filter(x=>x.type==='quiz');
    DATA.news = json.filter(x=>x.type==='news');
    document.getElementById('gamesGrid').innerHTML='';
    renderGames();
    renderQuizzes();
    renderNews();
  }catch(e){console.error('Erreur SheetDB', e);}
}

async function postSheetDB(item){
  try{
    const res = await fetch(SHEETDB_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({data:item})
    });
    return res.json();
  }catch(e){console.error('Erreur POST', e);}
}

async function deleteSheetDB(id){
  try{
    const res = await fetch(SHEETDB_URL+"/id/"+id,{method:"DELETE"});
    return res.json();
  }catch(e){console.error('Erreur DELETE', e);}
}

// ======================
// RENDER
// ======================
function renderGames(){
  const grid = document.getElementById('gamesGrid');
  DATA.games.forEach(g=>{
    const t = document.getElementById('cardTemplate').content.cloneNode(true);
    t.querySelector('h3').textContent = g.name;
    t.querySelector('p').textContent = 'Jeu interactif';
    t.querySelector('.card').onclick = ()=>{ if(g.name==='Morrison'){ renderMorpion(g); } };
    grid.appendChild(t);
  });
}

function renderNews(){
  const grid = document.getElementById('newsGrid'); grid.innerHTML='';
  DATA.news.forEach(n=>{
    const t = document.getElementById('cardTemplate').content.cloneNode(true);
    t.querySelector('h3').textContent = n.name;
    t.querySelector('p').textContent = n.content;
    grid.appendChild(t);
  });
}

function renderQuizzes(){
  const grid = document.getElementById('gamesGrid'); // m√™me grille que les jeux
  DATA.quizzes.forEach(q=>{
    const t = document.getElementById('cardTemplate').content.cloneNode(true);
    t.querySelector('h3').textContent = q.name;
    t.querySelector('p').textContent = 'Quiz interactif';
    t.querySelector('.card').onclick = ()=>{ renderQuiz(q); };
    grid.appendChild(t);
  });
}

// ======================
// MORRISON (MORPION) am√©lior√©
// ======================
function renderMorpion(game){
  const area = document.getElementById('gameArea');
  area.innerHTML='<h3>Morrison üü°üî¥</h3>';
  const rows=6, cols=7;
  const state = { board:Array(rows).fill(null).map(()=>Array(cols).fill(0)), turn:1, over:false, score:[0,0] };
  const boardEl = document.createElement('div'); boardEl.className='board'; boardEl.style.gridTemplateColumns=`repeat(${cols},1fr)`;
  const scoreEl = document.createElement('p'); scoreEl.textContent='Score Joueur 1: 0 | Joueur 2: 0'; area.appendChild(scoreEl);
  const resetBtn = document.createElement('button'); resetBtn.className='btn small'; resetBtn.textContent='R√©initialiser'; resetBtn.onclick=()=>{state.board=Array(rows).fill(null).map(()=>Array(cols).fill(0)); state.over=false; draw(); scoreEl.textContent='Score Joueur 1: 0 | Joueur 2: 0';}; area.appendChild(resetBtn);

  function draw(){
    boardEl.innerHTML='';
    for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
      const cell = document.createElement('div'); cell.className='cell';
      const val = state.board[r][c];
      if(val!==0){ const p=document.createElement('div'); p.className='piece'; p.style.background=val===1?'yellow':'red'; cell.appendChild(p);}
      cell.onclick = ()=>{
        if(state.over) return;
        for(let rr=rows-1;rr>=0;rr--){if(state.board[rr][c]===0){state.board[rr][c]=state.turn; if(checkWin(rr,c,state.turn)){state.over=true; alert('Joueur '+state.turn+' gagne !'); state.score[state.turn-1]++; scoreEl.textContent=`Score Joueur 1: ${state.score[0]} | Joueur 2: ${state.score[1]}`; } state.turn=3-state.turn; draw(); return;}}
      };
      boardEl.appendChild(cell);
    }
  }
  function checkWin(r,c,p){ const dirs=[[0,1],[1,0],[1,1],[1,-1]]; for(const [dr,dc] of dirs){let count=1; for(let k=1;k<4;k++){const rr=r+dr*k,cc=c+dc*k;if(rr<0||rr>=rows||cc<0||cc>=cols)break;if(state.board[rr][cc]===p)count++;else break;} for(let k=1;k<4;k++){const rr=r-dr*k,cc=c-dc*k;if(rr<0||rr>=rows||cc<0||cc>=cols)break;if(state.board[rr][cc]===p)count++;else break;} if(count>=4) return true;} return false;}
  area.appendChild(boardEl); draw();
}

// ======================
// QUIZ
// ======================
function renderQuiz(q){
  const area = document.getElementById('gameArea');
  area.innerHTML = `<h3>${q.name}</h3>`;
  let questions;
  try { questions = JSON.parse(q.content); } catch(e){ area.innerHTML += '<p>Erreur quiz JSON</p>'; return; }
  let index = 0, score = 0;
  const qEl = document.createElement('div'); area.appendChild(qEl);
  const renderQuestion = ()=>{
    qEl.innerHTML='';
    if(index >= questions.length){ area.innerHTML += `<p>Quiz termin√© ! Score: ${score}/${questions.length}</p>`; return; }
    const cur = questions[index];
    const qText = document.createElement('p'); qText.textContent=cur.q; qEl.appendChild(qText);
    cur.a.forEach((ans,i)=>{
      const btn = document.createElement('button'); btn.className='btn small'; btn.textContent=ans;
      btn.onclick = ()=>{ if(i===cur.correct) score++; index++; renderQuestion(); };
      qEl.appendChild(btn);
    });
  };
  renderQuestion();
}

// ======================
// ADMIN PANEL
// ======================
document.getElementById('adminBtn').onclick=()=>{
  const pwd = prompt('Mot de passe admin');
  if(pwd===ADMIN_PWD){ showAdmin(); } else alert('Mot de passe incorrect');
};

function showAdmin(){
  const area = document.getElementById('gameArea');
  area.innerHTML='<h3>Admin Panel üõ†</h3><div id="adminContent"></div>';
  const content = document.getElementById('adminContent');

  // Ajouter jeu
  const formGame = document.createElement('div');
  formGame.innerHTML=`<h4>Ajouter jeu</h4>
  <input type="text" id="gameName" placeholder="Nom du jeu">
  <input type="text" id="gameMetadata" placeholder='Metadata JSON'>
  <button class="btn small" id="addGameBtn">Ajouter</button>`;
  content.appendChild(formGame);
  document.getElementById('addGameBtn').onclick=async()=>{
    const name = document.getElementById('gameName').value;
    const meta = document.getElementById('gameMetadata').value;
    if(!name) return alert('Nom requis');
    let item={type:'game',name:name,metadata:meta};
    await postSheetDB(item); alert('Jeu ajout√©'); fetchSheetDB();
  };

  // Ajouter news
  const formNews = document.createElement('div');
  formNews.innerHTML=`<h4>Ajouter actualit√©</h4>
  <input type="text" id="newsTitle" placeholder="Titre">
  <textarea id="newsContent" placeholder="Contenu"></textarea>
  <button class="btn small" id="addNewsBtn">Ajouter</button>`;
  content.appendChild(formNews);
  document.getElementById('addNewsBtn').onclick=async()=>{
    const name = document.getElementById('newsTitle').value;
    const contentText = document.getElementById('newsContent').value;
    if(!name||!contentText) return alert('Tous les champs requis');
    let item={type:'news',name:name,content:contentText};
    await postSheetDB(item); alert('Actualit√© ajout√©e'); fetchSheetDB();
  };

  // Ajouter quiz
  const formQuiz = document.createElement('div');
  formQuiz.innerHTML = `<h4>Ajouter Quiz</h4>
  <input type="text" id="quizTitle" placeholder="Titre du quiz">
  <textarea id="quizContent" placeholder='Questions JSON (ex: [{"q":"Question?","a":["Rep1","Rep2"],"correct":0}])'></textarea>
  <button class="btn small" id="addQuizBtn">Ajouter Quiz</button>`;
  content.appendChild(formQuiz);
  document.getElementById('addQuizBtn').onclick = async () => {
      const title = document.getElementById('quizTitle').value;
      const content = document.getElementById('quizContent').value;
      if (!title || !content) return alert('Tous les champs requis');
      try { JSON.parse(content); } catch(e){ return alert('JSON invalide'); }
      let item = { type:'quiz', name:title, content:content };
      await postSheetDB(item); alert('Quiz ajout√©'); fetchSheetDB();
  };
}

// ======================
// INITIAL LOAD
// ======================
fetchSheetDB();
</script>
</body>
</html>
