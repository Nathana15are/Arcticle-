<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monkey Games üêµ</title>
<style>
:root{
  --bg:#0a1e0f;
  --card:#123018;
  --accent:#8b5cf6;
  --muted:#c0c0b0;
  --glass: rgba(255,255,255,0.05);
  font-family: 'Segoe UI', Roboto, sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background: linear-gradient(160deg,#0a1e0f,#123018); color:#e6eef8;}
.app{min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:20px; gap:20px;}
.header{width:100%; max-width:1200px; display:flex; justify-content:space-between; align-items:center;}
.logo{font-size:28px;font-weight:bold; color:var(--accent); text-shadow: 0 0 15px var(--accent);}
.subtitle{font-size:12px;color:var(--muted);}
.container{display:flex; flex-direction:column; width:100%; max-width:1200px; gap:20px;}
.panel{background:var(--card); border-radius:12px; padding:16px; box-shadow: 0 8px 20px rgba(0,0,0,0.7); transition:0.3s;}
.grid{display:grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); gap:16px;}
.card{background:var(--glass); padding:12px; border-radius:10px; cursor:pointer; transition:0.3s; display:flex; flex-direction:column; gap:6px; border:1px solid rgba(139,92,246,0.2);}
.card:hover{transform:translateY(-6px) rotateZ(1deg); box-shadow:0 12px 28px rgba(139,92,246,0.8); border:1px solid var(--accent);}
.btn{padding:8px 12px; border-radius:8px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(139,92,246,0.5); color:inherit; cursor:pointer; transition:0.3s;}
.btn:hover{box-shadow:0 0 12px var(--accent); transform:scale(1.05);}
.footer{text-align:center;color:var(--muted); font-size:12px;}
.admin-panel,.quiz-popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:1000;}
.admin-content,.quiz-content{background:var(--card); padding:20px; border-radius:12px; max-width:500px; width:90%; max-height:90%; overflow:auto; box-shadow:0 0 20px rgba(139,92,246,0.7);}
input,textarea{width:100%;margin:6px 0;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:inherit;}
.close-btn{margin-top:10px;background:var(--accent); color:#fff; cursor:pointer;}
@media(max-width:900px){
  .grid{grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap:12px;}
  .panel{padding:12px;}
}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div><span class="logo">Monkey Games üêµ</span><div class="subtitle">Th√®me Jungle N√©on ‚Ä¢ SheetDB</div></div>
    <div><button id="adminBtn" class="btn small">Admin</button></div>
  </div>

  <div class="container">
    <div class="panel">
      <h2>üéÆ Jeux & Quiz</h2>
      <div class="grid" id="gamesGrid"></div>
    </div>

    <div class="panel">
      <h2>üì∞ Actualit√©s</h2>
      <div id="newsGrid" class="grid"></div>
    </div>
  </div>

  <div class="footer">¬© 2025 Monkey Games ‚Äî Th√®me Jungle N√©on üçå</div>
</div>

<!-- Admin Panel -->
<div class="admin-panel" id="adminPanel">
  <div class="admin-content" id="adminContent">
    <h3>Admin Panel üõ†</h3>
    <div id="loginSection">
      <label>Mot de passe :</label>
      <input type="password" id="adminPwd" placeholder="Entrez le mot de passe">
      <button class="btn" id="loginBtn">Se connecter</button>
    </div>
    <div id="panelSection" style="display:none;">
      <h4>Cr√©er un Quiz</h4>
      <input type="text" id="quizName" placeholder="Nom du quiz">
      <input type="text" id="quizQ" placeholder="Question">
      <input type="text" id="quizA1" placeholder="R√©ponse 1">
      <input type="text" id="quizA2" placeholder="R√©ponse 2">
      <input type="text" id="quizA3" placeholder="R√©ponse 3">
      <input type="number" id="quizCorrect" placeholder="Bonne r√©ponse (0,1,2)">
      <button class="btn" id="addQuizBtn">Ajouter Quiz</button>

      <h4>Cr√©er une Actualit√©</h4>
      <input type="text" id="newsTitle" placeholder="Titre">
      <textarea id="newsContent" placeholder="Contenu"></textarea>
      <button class="btn" id="addNewsBtn">Ajouter Actualit√©</button>

      <button class="btn close-btn" id="closeAdminBtn">Fermer</button>
    </div>
  </div>
</div>

<!-- Quiz Popup -->
<div class="quiz-popup" id="quizPopup">
  <div class="quiz-content">
    <h3 id="quizTitle"></h3>
    <p id="quizQuestion"></p>
    <div id="quizAnswers"></div>
    <p id="quizResult" style="margin-top:10px;"></p>
    <button class="btn close-btn" id="closeQuizBtn">Fermer</button>
  </div>
</div>

<template id="cardTemplate">
  <div class="card">
    <h3></h3>
    <p></p>
  </div>
</template>

<script>
const SHEETDB_URL = "https://sheetdb.io/api/v1/lmifyr403m3ox";
const ADMIN_PWD = "Marius2013.";
let DATA = { quizzes: [], news: [] };

// --- Charger depuis SheetDB ---
async function fetchSheetDB(){
  try{
    const res = await fetch(SHEETDB_URL);
    const json = await res.json();
    DATA.quizzes = json.filter(x=>x.type==='quiz');
    DATA.news = json.filter(x=>x.type==='news');
    renderQuizzes();
    renderNews();
  }catch(e){console.error('Erreur SheetDB', e);}
}

async function postSheetDB(item){
  try{
    await fetch(SHEETDB_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({data:item})
    });
  }catch(e){console.error('Erreur POST', e);}
}

// --- Rendu ---
function renderNews(){
  const grid = document.getElementById('newsGrid'); grid.innerHTML='';
  DATA.news.forEach(n=>{
    const t = document.getElementById('cardTemplate').content.cloneNode(true);
    t.querySelector('h3').textContent = n.name;
    t.querySelector('p').textContent = n.content;
    grid.appendChild(t);
  });
}

function renderQuizzes(){
  const grid = document.getElementById('gamesGrid'); grid.innerHTML='';
  DATA.quizzes.forEach(q=>{
    const t = document.getElementById('cardTemplate').content.cloneNode(true);
    t.querySelector('h3').textContent = q.name;
    t.querySelector('p').textContent = 'Clique pour jouer üêí';
    const el = t.querySelector('.card');
    el.onclick = ()=>showQuiz(q);
    grid.appendChild(t);
  });
}

// --- Quiz Logic ---
function showQuiz(q){
  const popup = document.getElementById('quizPopup');
  const title = document.getElementById('quizTitle');
  const question = document.getElementById('quizQuestion');
  const answers = document.getElementById('quizAnswers');
  const result = document.getElementById('quizResult');

  title.textContent = q.name;
  const data = JSON.parse(q.content || "[]")[0];
  question.textContent = data.q;
  answers.innerHTML = "";
  result.textContent = "";

  data.a.forEach((a,i)=>{
    const btn = document.createElement('button');
    btn.className="btn";
    btn.style.display="block";
    btn.style.width="100%";
    btn.style.margin="6px 0";
    btn.textContent = a;
    btn.onclick=()=>{
      if(i===data.correct){
        result.textContent="Bonne r√©ponse üü©";
        result.style.color="lightgreen";
      }else{
        result.textContent="Mauvaise r√©ponse üü•";
        result.style.color="tomato";
      }
    };
    answers.appendChild(btn);
  });

  popup.style.display='flex';
}

document.getElementById('closeQuizBtn').onclick=()=>{
  document.getElementById('quizPopup').style.display='none';
};

// --- Admin ---
const adminBtn=document.getElementById('adminBtn');
const adminPanel=document.getElementById('adminPanel');
const loginBtn=document.getElementById('loginBtn');
const closeAdminBtn=document.getElementById('closeAdminBtn');

adminBtn.onclick=()=>adminPanel.style.display='flex';
closeAdminBtn.onclick=()=>adminPanel.style.display='none';

loginBtn.onclick=()=>{
  const pwd=document.getElementById('adminPwd').value;
  if(pwd===ADMIN_PWD){
    document.getElementById('loginSection').style.display='none';
    document.getElementById('panelSection').style.display='block';
  }else alert("Mot de passe incorrect üü•");
};

document.getElementById('addQuizBtn').onclick=async ()=>{
  const name=document.getElementById('quizName').value;
  const q=document.getElementById('quizQ').value;
  const a1=document.getElementById('quizA1').value;
  const a2=document.getElementById('quizA2').value;
  const a3=document.getElementById('quizA3').value;
  const correct=parseInt(document.getElementById('quizCorrect').value);
  if(!name||!q||!a1||!a2||!a3||isNaN(correct)){alert("Tous les champs sont requis");return;}
  const content=JSON.stringify([{q:q,a:[a1,a2,a3],correct:correct}]);
  await postSheetDB({type:"quiz",name:name,content:content});
  alert("Quiz ajout√© ‚úÖ");fetchSheetDB();
};

document.getElementById('addNewsBtn').onclick=async ()=>{
  const name=document.getElementById('newsTitle').value;
  const content=document.getElementById('newsContent').value;
  if(!name||!content){alert("Tous les champs sont requis");return;}
  await postSheetDB({type:"news",name:name,content:content});
  alert("Actualit√© ajout√©e ‚úÖ");fetchSheetDB();
};

fetchSheetDB();
</script>
</body>
</html>
